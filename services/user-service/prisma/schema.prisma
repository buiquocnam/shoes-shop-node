// ===========================================
// PRISMA SCHEMA CHO USER SERVICE
// Database: PostgreSQL
// ===========================================

generator client {
  provider = "prisma-client-js"
}

// ƒê·∫£m b·∫£o DATABASE_URL trong .env l√† PostgreSQL
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===========================================
// ‚ö†Ô∏è EXTERNAL REFERENCES (Tham chi·∫øu ngo√†i - KH√îNG T·∫†O B·∫¢NG)
// ===========================================

// User: L·∫•y ID t·ª´ Auth Service (B·∫£ng 'users' ƒë√£ ƒë∆∞·ª£c t·∫°o b·ªüi Auth Service)
model User {
  id      String @id @default(uuid()) @db.Uuid // Ph·∫£i kh·ªõp v·ªõi ki·ªÉu ID trong Auth Service
  
  // Quan h·ªá ng∆∞·ª£c
  cart    Cart[]
  reviews Review[]
  
  @@map("users") 
}

// Product Variant: L·∫•y ID t·ª´ Product Service (B·∫£ng 'product_variants' ƒë√£ ƒë∆∞·ª£c t·∫°o b·ªüi Product Service)
model ProductVariant {
  id    String @id @default(uuid()) @db.Uuid // Ph·∫£i kh·ªõp v·ªõi ki·ªÉu ID trong Product Service
  
  // Quan h·ªá ng∆∞·ª£c
  cart_items CartItem[]
  
  @@map("product_variants") 
}


// ===========================================
// üõí USER SERVICE OWNED COLLECTIONS
// ===========================================

// 1. CARTS (Gi·ªè h√†ng)
model Cart {
  id          String    @id @default(uuid()) @db.Uuid
  user_id     String    @db.Uuid // Kh√≥a ngo·∫°i t·ªõi User
  
  // M·ªëi quan h·ªá: User (Auth Service)
  user        User      @relation(fields: [user_id], references: [id])

  // M·ªëi quan h·ªá: Cart Items
  cart_items  CartItem[]

  created_at  DateTime  @default(now()) @map("created_at")

  @@map("carts")
}

// 2. CART ITEMS (Chi ti·∫øt s·∫£n ph·∫©m trong gi·ªè)
model CartItem {
  id                  String  @id @default(uuid()) @db.Uuid
  cart_id             String  @db.Uuid
  product_variant_id  String  @db.Uuid // Kh√≥a ngo·∫°i t·ªõi Product Variant
  quantity            Int     @default(1)

  // M·ªëi quan h·ªá: Cart
  cart                Cart            @relation(fields: [cart_id], references: [id])
  
  // M·ªëi quan h·ªá: Product Variant (Product Service)
  product_variant     ProductVariant  @relation(fields: [product_variant_id], references: [id])

  // ƒê·∫£m b·∫£o kh√¥ng c√≥ hai c√πng m·ªôt bi·∫øn th·ªÉ trong c√πng m·ªôt gi·ªè h√†ng
  @@unique([cart_id, product_variant_id], name: "cart_item_unique")
  @@map("cart_items")
}


// 3. REVIEWS (ƒê√°nh gi√°)
model Review {
  id          String    @id @default(uuid()) @db.Uuid
  product_id  String    @db.Uuid // ID S·∫£n ph·∫©m (t·ª´ Product Service)
  user_id     String    @db.Uuid // ID Ng∆∞·ªùi d√πng (t·ª´ Auth Service)
  rating      Int       @default(5) // 1 ƒë·∫øn 5
  comment     String?
  
  // M·ªëi quan h·ªá: User
  user        User      @relation(fields: [user_id], references: [id])

  created_at  DateTime  @default(now()) @map("created_at")

  @@map("reviews")
}

// 4. BANNERS (Qu·∫£ng c√°o)
model Banner {
  id          String    @id @default(uuid()) @db.Uuid
  title       String?
  image_url   String
  link        String?
  active      Boolean   @default(true)

  created_at  DateTime  @default(now()) @map("created_at")

  @@map("banners")
}