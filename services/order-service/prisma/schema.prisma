generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum PaymentMethod {
  cod
  momo
  zalopay
  paypal
}

enum PaymentStatus {
  pending
  paid
  failed
}

enum ShippingMethod {
  standard
  express
  pickup
}

enum ShippingStatus {
  pending
  processing
  shipping
  delivered
  cancelled
  returned
}

enum ShippingLogStatus {
  processing
  pickup
  shipping
  delivered
  failed
  returned
}

enum PaymentState {
  pending
  success
  failed
}

model Order {
  id              String    @id @default(uuid())
  
  // CHỈ LƯU userId, không relation
  userId          String
  
  totalAmount     Decimal   @db.Decimal(12,2)
  paymentMethod   PaymentMethod?
  paymentStatus   PaymentStatus?   @default(pending)
  shippingMethod  ShippingMethod?
  shippingFee     Decimal?  @db.Decimal(12,2)
  shippingStatus  ShippingStatus?  @default(pending)
  trackingCode    String?
  shippingAddress String
  receiverName    String?
  receiverPhone   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  items        OrderItem[]
  payments     Payment[]
  shippingLogs ShippingLog[]

  @@map("orders")
}

model OrderItem {
  id    String  @id @default(uuid())

  orderId String
  order   Order @relation(fields: [orderId], references: [id])
  
  // CHỈ LƯU productVariantId, không relation
  productVariantId String

  quantity Int
  price    Decimal @db.Decimal(12,2)

  @@map("order_items")
}

model ShippingLog {
  id        String          @id @default(uuid())
  orderId   String
  order     Order           @relation(fields: [orderId], references: [id])
  
  status    ShippingLogStatus
  note      String?
  updatedAt DateTime        @default(now()) @updatedAt

  @@map("shipping_logs")
}

model Payment {
  id            String      @id @default(uuid())
  orderId       String
  order         Order       @relation(fields: [orderId], references: [id])
  amount        Decimal     @db.Decimal(12,2)
  method        PaymentMethod
  status        PaymentState
  transactionId String?
  createdAt     DateTime    @default(now())

  @@map("payments")
}
