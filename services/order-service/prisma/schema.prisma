generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===================================
// üì¶ ORDER SERVICE MODELS (Using UUID)
// ===================================

enum PaymentMethod {
  cod
  momo
  zalopay
  paypal
}

enum PaymentStatus {
  pending
  paid
  failed
}

enum ShippingMethod {
  standard
  express
  pickup
}

enum ShippingStatus {
  pending
  processing
  shipping
  delivered
  cancelled
  returned
}

enum ShippingLogStatus {
  processing
  pickup
  shipping
  delivered
  failed
  returned
}

enum PaymentState {
  pending
  success
  failed
}

// =============== CARTS ===============
model Cart {
  id        String   @id @default(uuid())
  // üí° CH·ªà L√Ä KH√ìA NGO·∫†I: B·ªè @relation v√¨ User thu·ªôc Auth Service
  userId    String   @map("user_id") 
  createdAt DateTime @default(now()) @map("created_at")
  items     CartItem[]

  @@map("carts")
}

// =============== CART ITEMS ===============
model CartItem {
  id                 String @id @default(uuid())
  cartId             String @map("cart_id")
  cart               Cart   @relation(fields: [cartId], references: [id])
  // üí° CH·ªà L√Ä KH√ìA NGO·∫†I: B·ªè @relation v√¨ ProductVariant thu·ªôc Product Service
  productVariantId   String @map("product_variant_id") 
  quantity           Int    @default(1)

  @@map("cart_items")
}

// =============== ORDERS ===============
model Order {
  id              String          @id @default(uuid())
  // üí° CH·ªà L√Ä KH√ìA NGO·∫†I: B·ªè @relation v√¨ User thu·ªôc Auth Service
  userId          String          @map("user_id") 
  totalAmount     Decimal         @db.Decimal(12,2) @map("total_amount")
  paymentMethod   PaymentMethod?  @map("payment_method")
  paymentStatus   PaymentStatus?  @map("payment_status")
  shippingMethod  ShippingMethod? @map("shipping_method")
  shippingFee     Decimal?        @db.Decimal(12,2) @map("shipping_fee")
  shippingStatus  ShippingStatus? @map("shipping_status")
  trackingCode    String?         @map("tracking_code")
  shippingAddress String          @map("shipping_address")
  receiverName    String?         @map("receiver_name")
  receiverPhone   String?         @map("receiver_phone")
  createdAt       DateTime        @default(now()) @map("created_at")
  updatedAt       DateTime        @updatedAt @map("updated_at")
  
  items           OrderItem[]
  payments        Payment[]
  shippingLogs    ShippingLog[]

  @@map("orders")
}

// =============== ORDER ITEMS ===============
model OrderItem {
  id                 String  @id @default(uuid())
  orderId            String  @map("order_id")
  order              Order   @relation(fields: [orderId], references: [id])
  // üí° CH·ªà L√Ä KH√ìA NGO·∫†I: B·ªè @relation v√¨ ProductVariant thu·ªôc Product Service
  productVariantId   String  @map("product_variant_id") 
  quantity           Int     @default(1)
  price              Decimal @db.Decimal(12,2)

  @@map("order_items")
}

// =============== SHIPPING LOGS ===============
model ShippingLog {
  id        String          @id @default(uuid())
  orderId   String          @map("order_id")
  order     Order           @relation(fields: [orderId], references: [id])
  status    ShippingLogStatus @map("status")
  note      String?
  updatedAt DateTime        @default(now()) @updatedAt @map("updated_at")

  @@map("shipping_logs")
}

// =============== PAYMENTS ===============
model Payment {
  id            String        @id @default(uuid())
  orderId       String        @map("order_id")
  order         Order         @relation(fields: [orderId], references: [id])
  amount        Decimal       @db.Decimal(12,2)
  method        PaymentMethod
  status        PaymentState
  transactionId String?       @map("transaction_id")
  createdAt     DateTime      @default(now()) @map("created_at")

  @@map("payments")
}